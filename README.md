# Домашнее задание к занятию «Helm» - Тертерян Вячеслав

---

### Задание   

Необходимо определить требуемые ресурсы.
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения.
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.  

Ответ:  

Итак, сначала учтем накладные расходы, это примерно 15% (основываюсь на своей практике построения сетей). Обычно этого запаса хватает и поидее должно хватить на разного рода core_dump, self оптимизации BD и т.д.   
С учетом, что не огоорена динамичность нагрузки на сервис, будем счиатать, что она статичка и deploy происходит методом canary.  
Получатеся что у нас 3 основных окружения: dev, stage, prod.
Общую мощность серверов, с учетом запаса в можности на отказ 1 ноды, рассчитывается по формуле N+1.
Посчитаем требования к ресурсам:  
1. БД - использует 4 ГБ ОЗУ в работе, 1 ядро, с учетом накладных получится 4711МБ (4096+615) и 1.15 CPU * 3 копии = 14,1Gb RAM 3.5 CPU (данные округленны в большую сторону)  
2. Кэш - использует 4 ГБ ОЗУ в работе, 1 ядро, с учетом накладных получится 4711МБ (4096+615) и 1.15 CPU * 3 копии = 14,1Gb RAM 3.5 CPU (данные округленны в большую сторону)  
3. Фронтенд - 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра, с учетом накладных расхонов 62 МБ и 0.23 CPU  * 5 копий = 310 RAM + 1,1 CPU (данные округленны в большую сторону)  
4. Бекенд - 600 МБ ОЗУ и по 1 ядру на копию, у четом накладных расходов получается 690 ОЗУ + 1.15 CPU * 10 копий = 6900 RAM и 11.5 CPU (данные округленны в большую сторону).  

Итого, общее подтербление ресурсов на сервис:
CPU = 3.5 + 3.5 + 1.1 + 11.5 = 19.6 CPU
RAM = 14100 + 14100 + 310 + 6900 = 35410 МБ = 34,6 ГБ  

Поскольку требуется отказаустойчивость, то предполагается распределние по нодам нагрузки, предположим у нас будет классика и будет 3 ноды тогда нагрузка на каждую будет следующая:  

CPU = 19.6/3 = 6,5  
RAM = 34.6/3 = 11.5 ГБ (округлим до 12)

Согласно источнику (предоставленному в задании) учтем расходы системы, kubelet'a и запас в 100 МБ, добавим расходы на zabbix, node exporter, безопасность, получается прибавляем к каждой ноде: 2 ГБ ОЗУ, 1 CPU.

Итого для развертывания сервиса в трех средах на трех серверах понадобятся следующие мощности:  

1. 3 сервера с минимальными характеристиками 20.6 CPU (мне кажется допустимо округлить до 20, так как был заложен резерв в 15 процентов) и 36,6 ГБ ОЗУ (опять же окргулим в сторону 36) каждый.